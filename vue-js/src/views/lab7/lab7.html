<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 7 - JavaScript Nâng Cao (jQuery)</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            line-height: 1.6;
        }
        
        section {
            border: 1px solid #ccc;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        h2 {
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            color: #007bff;
        }
        
        .error {
            color: red;
            font-weight: bold;
            margin-left: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #007bff;
            color: white;
        }
        /* CSS cho Bài 1 để dễ nhìn kết quả */
        
        #bai1 ul li {
            padding: 5px;
            margin: 2px 0;
            border: 1px solid #eee;
        }
    </style>
</head>

<body>

    <section id="bai1">
        <h2>Bài 1: jQuery Selector & CSS</h2>
        <div class="content">
            <span>Line 0: Đây là thẻ span 1</span><br>
            <span>Line 1: Đây là thẻ span 2</span><br>
            <p id="line1">Line 2: P có id="line1"</p>
            <p class="line2">Line 3: P có class="line2"</p>
            <p line-count="line3">Line 4: P có attribute line-count="line3"</p>
            <p selectedLine>Line 5: P có attribute selectedLine</p>
            <br>
            <ul>
                <li>Item 1 (Li đầu tiên)</li>
                <li>Item 2 (Li chẵn)</li>
                <li>Item 3</li>
                <li>Item 4 (Li chẵn)</li>
                <li>Item 5 (Li cuối cùng)</li>
            </ul>
        </div>
        <button type="button" onclick="runBai1()">Click để chạy hiệu ứng Bài 1</button>
    </section>

    <section id="bai2">
        <h2>Bài 2: Event & Validation</h2>
        <label>Nhập username:</label>
        <input type="text" id="username_bai2" placeholder="Nhập username...">
        <span id="errMsg_bai2" class="error"></span>
        <br><br>
        <button id="validateUser" type="button">Kiểm tra</button>
    </section>

    <section id="bai3">
        <h2>Bài 3: Thao tác DOM (Thêm sinh viên)</h2>
        <h3>Danh sách sinh viên</h3>
        <input type="text" id="studentName_bai3" placeholder="Tên sinh viên...">
        <span id="errMsg_bai3" class="error"></span>
        <button id="addStudent" type="button">Add Student</button>
        <ul id="list_bai3">
            <li>Trần Thị Loan</li>
        </ul>
    </section>

    <section id="bai4">
        <h2>Bài 4: Fetch API & Render Table</h2>
        <p>Dữ liệu lấy từ: https://reqres.in/api/products</p>
        <button id="loadDataBtn">Tải dữ liệu</button>
        <table id="productTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Year</th>
                    <th>Color</th>
                    <th>Pantone Value</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </section>

    <script>
        // Đợi trang web tải xong hoàn toàn mới chạy code jQuery
        $(document).ready(function() {

            // --- XỬ LÝ BÀI 1 ---
            // Tôi bọc vào hàm để bạn click nút mới thấy hiệu ứng thay đổi
            window.runBai1 = function() {
                // 1. Thay đổi màu tất cả thẻ span
                $('#bai1 span').css('color', 'blue');

                // 2. Thay đổi màu p id="line1"
                $('#line1').css('color', 'red');

                // 3. Thay đổi màu p class="line2"
                $('.line2').css('color', 'green');

                // 4. Thay đổi màu p có attribute line-count="line3"
                $('[line-count="line3"]').css('color', 'orange'); // Attribute selector

                // 5. Thay đổi màu p có attribute selectedLine
                $('[selectedLine]').css('color', 'purple');

                // 6. Thẻ li đầu tiên
                $('#bai1 ul li:first').css('background-color', '#ffcccb');

                // 7. Thẻ li cuối cùng
                $('#bai1 ul li:last').css('background-color', '#90ee90');

                // 8. Thẻ li ở vị trí chẵn (Trong code máy tính: 0, 2, 4... là chẵn)
                $('#bai1 ul li:even').css('font-weight', 'bold');

                // 9. Hover chuột (mouseenter và mouseleave)
                $('#bai1 ul li').hover(
                    function() { // Khi chuột vào
                        $(this).css('color', 'red');
                    },
                    function() { // Khi chuột ra
                        $(this).css('color', 'black');
                    }
                );

                alert("Đã áp dụng CSS cho Bài 1!");
            };

            // --- XỬ LÝ BÀI 2 ---
            $('#validateUser').click(function() {
                // Lấy giá trị input
                let user = $('#username_bai2').val().trim();
                let $errSpan = $('#errMsg_bai2');
                let error = "";

                // Validate dữ liệu
                if (user === "") {
                    error = "Tên đăng nhập không được để trống";
                } else if (user.length < 4) {
                    error = "Tên đăng nhập không được ít hơn 4 ký tự";
                } else if (user.length > 30) {
                    error = "Tên đăng nhập không nhiều hơn 30 ký tự";
                } else if (!user.includes("poly")) {
                    error = "Tên đăng nhập phải chứa ký tự 'poly'";
                }

                // Kiểm tra có lỗi hay không
                if (error !== "") {
                    $errSpan.text(error); // Hiển thị lỗi
                } else {
                    $errSpan.text(""); // Xóa lỗi
                    alert("Username hợp lệ: " + user);
                }
            });

            // --- XỬ LÝ BÀI 3 ---
            $('#addStudent').click(function() {
                let name = $('#studentName_bai3').val().trim();
                let $errSpan = $('#errMsg_bai3');
                let error = "";

                // Validate
                if (name === "") {
                    error = "Không để trống tên sinh viên";
                } else if (name.length > 30) {
                    error = "Tên sinh viên không vượt quá 30 ký tự";
                }

                if (error !== "") {
                    $errSpan.text(error);
                } else {
                    $errSpan.text("");
                    // Thêm thẻ li vào ul (append)
                    $('#list_bai3').append('<li>' + name + '</li>');
                    // Xóa nội dung input sau khi thêm
                    $('#studentName_bai3').val("");
                }
            });

            // --- XỬ LÝ BÀI 4 ---
            $('#loadDataBtn').click(function() {
                // Fetch API (Lưu ý: URL đã sửa từ regres.in thành reqres.in)
                fetch('https://reqres.in/api/products?page=1&per_page=5')
                    .then(response => response.json())
                    .then(data => {
                        let products = data.data; // Mảng dữ liệu trả về
                        let htmlContent = "";

                        // Duyệt qua từng sản phẩm và tạo hàng bảng (tr)
                        // Sử dụng jQuery $.each để duyệt mảng
                        $.each(products, function(index, item) {
                            htmlContent += `
                                <tr>
                                    <td>${item.id}</td>
                                    <td>${item.name}</td>
                                    <td>${item.year}</td>
                                    <td><span style="background-color:${item.color}; padding: 0 10px; border:1px solid #ccc;">&nbsp;</span> ${item.color}</td>
                                    <td>${item.pantone_value}</td>
                                </tr>
                            `;
                        });

                        // Chèn nội dung vào tbody
                        $('#productTable tbody').html(htmlContent);
                    })
                    .catch(error => {
                        console.error('Lỗi:', error);
                        alert("Không thể tải dữ liệu. Vui lòng kiểm tra console.");
                    });
            });

        });
    </script>
</body>

</html>