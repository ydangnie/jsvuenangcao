<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 5 - JavaScript Nâng Cao - Full Solution</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f4f4f4;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        h1,
        h2 {
            color: #333;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px 5px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            text-decoration: none;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        .note {
            background: #e9ecef;
            padding: 10px;
            border-left: 5px solid #007bff;
            margin-bottom: 20px;
        }
        
        pre {
            background: #272822;
            color: #f8f8f2;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Lab 5: Lập Trình JavaScript Nâng Cao</h1>
        <p class="note">⚠️ <strong>Lưu ý:</strong> Hãy mở <strong>Console</strong> (nhấn F12 -> chọn tab Console) để xem kết quả chạy của các bài tập.</p>

        <section>
            <h2>Bài 1: Xử lý Callback Hell</h2>
            <p>Sử dụng kỹ thuật tách hàm (Named Functions) để code gọn gàng hơn.</p>
            <button class="btn" onclick="runBai1()">▶ Chạy Bài 1</button>
        </section>

        <hr>

        <section>
            <h2>Bài 2: Sử dụng Promise</h2>
            <p>Chuyển đổi quy trình bài 1 sang sử dụng đối tượng Promise.</p>
            <button class="btn" onclick="runBai2()">▶ Chạy Bài 2</button>
        </section>

        <hr>

        <section>
            <h2>Bài 3: Nhập điểm với Promise</h2>
            <p>Nhập thông tin sinh viên và điểm thành phần (có độ trễ 3s, 4s) và xếp loại.</p>
            <button class="btn" onclick="runBai3()">▶ Chạy Bài 3</button>
        </section>

        <hr>

        <section>
            <h2>Bài 4</h2>
            <p>Bài tập tự chọn của giáo viên (vui lòng tự bổ sung theo yêu cầu trên lớp).</p>
        </section>
    </div>

    <script>
        // ======================================================
        // BÀI 1: XỬ LÝ CALLBACK HELL (Dùng Named Functions)
        // ======================================================

        // Giữ nguyên các hàm gốc đề bài cho, chỉ thay đổi cách gọi
        function ThucDay(viectieptheo) {
            console.log("b1. Đã ngủ dậy!");
            viectieptheo();
        }

        function DanhRang(viectieptheo) {
            console.log("b2. Đang đánh răng");
            setTimeout(function() {
                console.log("Đã đánh răng xong!");
                viectieptheo();
            }, 2000);
        }

        function ThayQuanAo(viectieptheo) {
            console.log("b3. Đang thay quan ao");
            setTimeout(function() {
                console.log("Đã thay quần áo xong!");
                viectieptheo();
            }, 3000);
        }

        function DiHoc(viectieptheo) {
            viectieptheo();
        }

        // --- Giải pháp Callback Hell: Tách các bước thành hàm riêng lẻ ---
        function buocDenTruong() {
            console.log("b4. Đang di chuyển...");
            setTimeout(function() {
                console.log("Đã đến trường! (Kết thúc Bài 1)");
                console.log("-----------------------------");
            }, 4000);
        }

        function buocDiHoc() {
            DiHoc(buocDenTruong);
        }

        function buocThayQuanAo() {
            ThayQuanAo(buocDiHoc);
        }

        function buocDanhRang() {
            DanhRang(buocThayQuanAo);
        }

        function runBai1() {
            console.clear();
            console.log("=== BẮT ĐẦU BÀI 1 ===");
            ThucDay(buocDanhRang);
            // Code đã phẳng hơn, không còn lồng nhau kiểu tam giác (pyramid of doom)
        }


        // ======================================================
        // BÀI 2: SỬ DỤNG PROMISE
        // ======================================================

        // Viết lại các hàm sử dụng Promise
        const thucDayPromise = () => {
            return new Promise((resolve) => {
                console.log("b1. Đã ngủ dậy!");
                resolve();
            });
        };

        const danhRangPromise = () => {
            return new Promise((resolve) => {
                console.log("b2. Đang đánh răng");
                setTimeout(() => {
                    console.log("Đã đánh răng xong!");
                    resolve();
                }, 2000);
            });
        };

        const thayQuanAoPromise = () => {
            return new Promise((resolve) => {
                console.log("b3. Đang thay quan ao");
                setTimeout(() => {
                    console.log("Đã thay quần áo xong!");
                    resolve();
                }, 3000);
            });
        };

        const diHocPromise = () => {
            return new Promise((resolve) => {
                console.log("b4. Đang di chuyển...");
                setTimeout(() => {
                    console.log("Đã đến trường! (Kết thúc Bài 2)");
                    console.log("-----------------------------");
                    resolve();
                }, 4000);
            });
        };

        function runBai2() {
            console.clear();
            console.log("=== BẮT ĐẦU BÀI 2 (PROMISE) ===");

            thucDayPromise()
                .then(danhRangPromise)
                .then(thayQuanAoPromise)
                .then(diHocPromise)
                .catch((err) => console.log("Có lỗi xảy ra:", err));
        }


        // ======================================================
        // BÀI 3: NHẬP ĐIỂM VỚI PROMISE & PROMPT
        // ======================================================

        // Hàm tiện ích để tạo độ trễ (delay)
        const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        function runBai3() {
            console.clear();
            console.log("=== BẮT ĐẦU BÀI 3 ===");

            let student = {};

            // Bắt đầu chuỗi Promise
            new Promise((resolve, reject) => {
                    // 1. Nhập Họ tên & Môn học
                    let ten = prompt("Nhập họ và tên sinh viên:");
                    let mon = prompt("Nhập tên môn học:");

                    if (!ten || !mon) {
                        reject("Bạn chưa nhập đủ thông tin ban đầu!");
                        return;
                    }

                    student.ten = ten;
                    student.mon = mon;
                    resolve();
                })
                .then(() => {
                    // 2. Nhập Lab 1 (chiếm 10%)
                    let lab1 = parseFloat(prompt(`Nhập điểm Lab 1 (10%) cho môn ${student.mon}:`));
                    student.lab1 = lab1 || 0;
                    console.log(`Đã nhập Lab 1: ${student.lab1}`);

                    console.log("Đang chờ 3 giây để nhập Lab 2...");
                    return wait(3000); // Chờ 3s
                })
                .then(() => {
                    // 3. Nhập Lab 2 (chiếm 20%)
                    let lab2 = parseFloat(prompt("Nhập điểm Lab 2 (20%):"));
                    student.lab2 = lab2 || 0;
                    console.log(`Đã nhập Lab 2: ${student.lab2}`);

                    console.log("Đang chờ 4 giây để nhập Lab 3...");
                    return wait(4000); // Chờ 4s
                })
                .then(() => {
                    // 4. Nhập Lab 3 (chiếm 30%)
                    let lab3 = parseFloat(prompt("Nhập điểm Lab 3 (30%):"));
                    student.lab3 = lab3 || 0;
                    console.log(`Đã nhập Lab 3: ${student.lab3}`);

                    console.log("Đang chờ 3 giây để nhập Thi Final...");
                    return wait(3000); // Chờ 3s
                })
                .then(() => {
                    // 5. Nhập Thi Final (chiếm 40%)
                    let final = parseFloat(prompt("Nhập điểm Thi Final (40%):"));
                    student.final = final || 0;
                    console.log(`Đã nhập Final: ${student.final}`);

                    // Tính toán kết quả
                    return calculateResult(student);
                })
                .catch((err) => {
                    console.error("Lỗi:", err);
                    alert("Có lỗi hoặc bạn đã hủy nhập liệu: " + err);
                });
        }

        function calculateResult(std) {
            // Tính điểm trung bình
            let avg = (std.lab1 * 0.1) + (std.lab2 * 0.2) + (std.lab3 * 0.3) + (std.final * 0.4);
            avg = avg.toFixed(2); // Làm tròn 2 số thập phân

            // Xếp loại học lực
            let xepLoai = "";
            if (avg < 5) {
                xepLoai = "Yếu";
            } else if (avg >= 5 && avg < 7) {
                xepLoai = "Trung Bình Khá";
            } else if (avg >= 7 && avg < 8.5) {
                xepLoai = "Khá";
            } else if (avg >= 8.5 && avg <= 10) {
                xepLoai = "Giỏi";
            } else {
                xepLoai = "Không xác định (Điểm không hợp lệ)";
            }

            // Xuất kết quả ra console
            console.log("====================================");
            console.log(`SINH VIÊN: ${std.ten.toUpperCase()}`);
            console.log(`MÔN HỌC: ${std.mon}`);
            console.log(`Điểm TB: ${avg}`);
            console.log(`XẾP LOẠI: ${xepLoai}`);
            console.log("====================================");

            // Hiển thị alert cho người dùng dễ thấy
            alert(`Sinh viên: ${std.ten}\nĐiểm TB: ${avg}\nXếp loại: ${xepLoai}`);
        }
    </script>

</body>

</html>