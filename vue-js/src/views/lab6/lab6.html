<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 6 - JavaScript Nâng Cao</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        h1,
        h2 {
            color: #333;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        ul {
            list-style-type: none;
            padding: 0;
        }
        
        li {
            background: #eee;
            margin: 5px 0;
            padding: 10px;
            border-radius: 4px;
            border-left: 5px solid #007bff;
        }
        
        code {
            background: #333;
            color: #fff;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .note {
            color: red;
            font-style: italic;
            font-size: 0.9em;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>LAB 6: JSON Object & AJAX</h1>

        <div class="section">
            <h2>Bài 1 & 2: JSON Object và Promise</h2>
            <p>Tạo mảng products và hiển thị lên danh sách bên dưới.</p>
            <button class="btn" onclick="runBai2()">Chạy Bài 1 & 2</button>

            <h3>Kết quả hiển thị (ul#target):</h3>
            <ul id="target">
            </ul>
        </div>

        <div class="section">
            <h2>Bài 3 & 4: Fetch API</h2>
            <p>Lấy dữ liệu từ server (Reqres.in) và hiển thị.</p>
            <p class="note">*Lưu ý: Bài 3 yêu cầu xem kết quả trong tab Console (F12).</p>
            <button class="btn" onclick="runBai3Va4()">Chạy Bài 3 & 4</button>

            <h3>Kết quả hiển thị (ul#target-api):</h3>
            <ul id="target-api">
            </ul>
        </div>
    </div>

    <script>
        // =============================================================
        // BÀI 1: TẠO MẢNG JSON OBJECT
        // =============================================================
        // Yêu cầu: Tạo mảng products gồm 5 phần tử dựa trên cấu trúc bảng

        var products = [{
            id: 32,
            name: "Deven Carroll DDS",
            image: "https://lorempixel.com/640/480/cats/?95559",
            cate_id: 3,
            price: 2000
        }, {
            id: 33,
            name: "Ava Olson",
            image: "https://lorempixel.com/640/480/cats/?43699",
            cate_id: 3,
            price: 3000
        }, {
            id: 34,
            name: "Long Dep Trai",
            image: "https://lorempixel.com/640/480/cats/?78623",
            cate_id: 5,
            price: 5000
        }, {
            id: 35,
            name: "Samir Schumm DVM",
            image: "https://lorempixel.com/640/480/cats/?56187",
            cate_id: 2,
            price: 83653
        }, {
            id: 37,
            name: "Javier Sipes",
            image: "https://lorempixel.com/640/480/cats/?27602",
            cate_id: 6,
            price: 84750
        }];

        // =============================================================
        // BÀI 2: SỬ DỤNG PROMISE ĐỂ HIỂN THỊ DỮ LIỆU
        // =============================================================

        function runBai2() {
            var ulElement = document.querySelector('#target');

            // Tạo Promise như đề bài yêu cầu
            new Promise(function(resolve, reject) {
                var strContent = "";

                // Duyệt mảng và tạo chuỗi HTML thẻ <li>
                products.forEach(function(val, index) {
                    // Đề bài yêu cầu hiển thị tên sản phẩm
                    strContent += `<li>${val.name}</li>`;
                });

                // Trả về kết quả thành công
                return resolve(strContent);

            }).then(function(data) {
                // Nhận data từ resolve và gán vào innerHTML
                ulElement.innerHTML = data;
                console.log("Đã hoàn thành Bài 2!");
            });
        }

        // =============================================================
        // BÀI 3: SỬ DỤNG FETCH()
        // =============================================================

        // Đường dẫn API (Dựa vào output trong file PDF trang 4, đây là API của ReqRes)
        const apiUrl = 'https://reqres.in/api/users?page=1&per_page=3';

        function runBai3Va4() {
            console.clear();
            console.log("--- BẮT ĐẦU BÀI 3 ---");

            // Gọi fetch
            fetch(apiUrl)
                .then(function(response) {
                    // Chuyển đổi dữ liệu nhận được sang JSON
                    return response.json();
                })
                .then(function(jsonData) {
                    // --- XỬ LÝ BÀI 3: HIỂN THỊ RA CONSOLE ---
                    console.log("Dữ liệu nhận được từ Server:");
                    console.log(jsonData);

                    // --- CHUYỂN SANG XỬ LÝ BÀI 4 ---
                    // Truyền dữ liệu sang hàm xử lý giao diện bài 4
                    hienThiBai4(jsonData.data);
                })
                .catch(function(error) {
                    console.log("Có lỗi xảy ra: " + error);
                });
        }

        // =============================================================
        // BÀI 4: KẾT HỢP FETCH VÀ HIỂN THỊ LÊN MÀN HÌNH
        // =============================================================

        function hienThiBai4(usersList) {
            var ulApiElement = document.querySelector('#target-api');

            // Sử dụng Promise tương tự logic Bài 2 để xử lý hiển thị
            new Promise(function(resolve, reject) {
                var html = "";

                // Yêu cầu: Hiển thị "id - full name"
                usersList.forEach(function(user) {
                    html += `<li>${user.id} - ${user.first_name} ${user.last_name}</li>`;
                });

                resolve(html);

            }).then(function(result) {
                // Gán vào giao diện
                ulApiElement.innerHTML = result;
            });
        }
    </script>

</body>

</html>